# Этап 1: Используем официальный образ Python как основу.
# 'slim' версия меньше по размеру, что идеально для продакшена.
FROM python:3.12-slim

# Устанавливаем рабочую директорию внутри контейнера.
# Все последующие команды будут выполняться из этой папки.
WORKDIR /app

# Обновляем pip и устанавливаем poetry для управления зависимостями
RUN pip install --no-cache-dir --upgrade pip

# Копируем только файл с зависимостями.
# Docker кэширует этот слой. Переустановка зависимостей будет происходить
# только если requirements.txt изменится, что сильно ускоряет сборку.
COPY requirements.txt .

# Устанавливаем зависимости проекта.
# --no-cache-dir уменьшает размер итогового образа.
RUN pip install --no-cache-dir -r requirements.txt

# Копируем все остальные файлы проекта в рабочую директорию.
# Это делается после установки зависимостей для лучшего кэширования.
COPY . .

# Команда, которая будет выполняться при запуске контейнера.
# Запускаем бота через модуль.
CMD ["python", "-m", "bot.main"]